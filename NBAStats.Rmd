---
title: "GroupProject2"
author: "Miguel Bonilla, Jordan Eaddy, Milan Patel"
date: "7/21/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(GGally)
```

##load data
will clean to remove opposing teams stats since they're actually including from the other team's perspective (tor vs atl, atl vs tor)
also dropping date since game number is more useful as a measure of the point in the season the game took place


```{r}
rawdata <- read.csv("https://raw.githubusercontent.com/boneeyah/GroupProject2/main/DataFile/nba.games.stats.csv")
cleandata <- rawdata[,c(7,3,5,8,10:25)] #rearrange to leave W/L first

str(cleandata) #check variable type

cleandata %>% count(WINorLOSS) %>% ggplot(aes(x=WINorLOSS, y= n, fill = WINorLOSS))+geom_bar(stat = "identity") 
#data is perfectly balanced, becasue for each win on the data set there is an opposing team who lost and vice-versa

#set categorical variables to factors
cleandata$WINorLOSS <- as.factor(cleandata$WINorLOSS)
cleandata$Home <- as.factor(cleandata$Home)

##change variable names
cleandata <- rename(cleandata, c("PTS" = TeamPoints, "FG"=FieldGoals,"FGA"=FieldGoalsAttempted, "FG%"=FieldGoals., "3PA"=X3PointShotsAttempted, "3P" = X3PointShots, "3P%"=X3PointShots.,"FT"=FreeThrows, "FTA"=FreeThrowsAttempted, "FT%"=FreeThrows.,"ORB"=OffRebounds,"TRB"=TotalRebounds, "AST"=Assists, "STL"=Steals,"BLK"=Blocks,"TOV"=Turnovers, "PF"=TotalFouls))

sapply(cleandata, function(x) sum(is.na(x))) #no NAs present

ggpairs(cleandata, columns = 2:10, aes(color = WINorLOSS))
ggpairs(cleandata, columns = 11:20, aes(color = WINorLOSS))

```
There is a separation between home and away
also for team points, field goals, field goal %, 3 point shots and 3 point shot %
to a lesser extent, total rebounds, assists, and turnovers
```{r}
plot(WINorLOSS~Home, col = c("#F8766D","#00bfc4"), data = cleandata)
plot(PTS~Home, col = c("#F8766D","#00bfc4"), data = cleandata)
plot(`FG%`~Home, col = c("#F8766D","#00bfc4"), data = cleandata)
plot(FG~Home, col = c("#F8766D","#00bfc4"), data = cleandata)
plot(`3PA`~Home, col = c("#F8766D","#00bfc4"), data = cleandata)
plot(`3P%`~Home, col = c("#F8766D","#00bfc4"), data = cleandata)
plot(TRB~Home, col = c("#F8766D","#00bfc4"), data = cleandata)
plot(AST~Home, col = c("#F8766D","#00bfc4"), data = cleandata)
```
##correlation plot
build a heatmap to check for correlation between explanatory variables
```{r}
library(lattice)
library(reshape2)
library(ggthemes)
cleandata.corr <- round(cor(cleandata[,c(2,4:20)]),2)
cleandata.corr <- melt(cleandata.corr)

cleandata.corr %>% ggplot(aes(x=Var1, y=Var2, fill=value))+geom_tile()+scale_fill_viridis_c()+theme(axis.title.x = element_blank(),axis.title.y = element_blank())
```

```{r}
#set seed
set.seed(8721)
##80-20 split of data
index <- sample(nrow(cleandata), round(.8*nrow(cleandata)))
train <- cleandata[index,]
test <- cleandata[-index,]


simple.mod <- glm(WINorLOSS~ Home + PTS + `FG%` + TRB, family = "binomial", data=train)
coef(simple.mod)

fit.pred <- predict(simple.mod, newdata = test, type = "response")
fit.pred <- ifelse(fit.pred > .5, "W", "L")
fit.pred <- factor(fit.pred, levels = c("W","L"))
test$WINorLOSS <- factor(test$WINorLOSS, levels = c("W", "L"))

caret::confusionMatrix(data =fit.pred, reference = test$WINorLOSS)
```

